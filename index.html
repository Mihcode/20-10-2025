<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kh√°m Ph√° B·∫£n Th√¢n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #ffdde1 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(255, 105, 180, 0.3);
            max-width: 800px;
            width: 100%;
            overflow: hidden;
            position: relative;
            border: 3px solid rgba(255, 182, 193, 0.3);
        }

        .screen {
            display: none;
            padding: 40px;
            min-height: 500px;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading Screen */
        .loading {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 107, 157, 0.2);
            border-top-color: #ff6b9d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2em;
            color: #ff6b9d;
            font-weight: 600;
        }

        /* Welcome Screen */
        .welcome {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .welcome h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #ff6b9d, #ff8fab, #ffc3d9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .welcome p {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .btn {
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.6);
        }

        /* Round Screens */
        .round-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .round-number {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
        }

        .round-title {
            font-size: 2em;
            color: #ff6b9d;
            margin-bottom: 10px;
        }

        .round-subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .option-card {
            background: linear-gradient(135deg, #fff5f7 0%, #ffe4e9 100%);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .option-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
        }

        .option-card.selected {
            border-color: #ff6b9d;
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            color: white;
        }

        .option-card.selected::before {
            opacity: 1;
        }

        .option-icon {
            font-size: 3.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            filter: drop-shadow(2px 2px 4px rgba(255, 107, 157, 0.2));
        }

        .option-name {
            font-size: 1.1em;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .color-option {
            height: 150px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 4px solid transparent;
            display: flex;
            align-items: flex-end;
            padding: 15px;
            position: relative;
        }

        .color-option:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .color-option.selected {
            border-color: white;
            box-shadow: 0 0 0 4px #ff6b9d, 0 15px 40px rgba(255, 107, 157, 0.4);
            transform: translateY(-5px) scale(1.05);
        }

        .color-name {
            color: white;
            font-weight: 700;
            font-size: 1.1em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            width: 100%;
            text-align: center;
        }

        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ffd4e5;
            transition: all 0.3s;
        }

        .progress-dot.active {
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            width: 30px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(255, 107, 157, 0.4);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
            flex: 1;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            flex: 1;
        }

        /* Result Screen */
        .result {
            text-align: center;
        }

        .result-image {
            width: 100%;
            max-width: 500px;
            height: 350px;
            background: linear-gradient(135deg, #fff5f7, #ffe4e9);
            border-radius: 20px;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.2);
            border: 3px solid rgba(255, 182, 193, 0.3);
        }

        .result-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .result-image-placeholder {
            font-size: 6em;
        }

        .result-message {
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .result-description {
            color: #666;
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .result-combo {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .combo-item {
            background: linear-gradient(135deg, #fff5f7, #ffe4e9);
            padding: 15px 25px;
            border-radius: 15px;
            font-weight: 600;
            color: #ff6b9d;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.2);
        }

        .error-message {
            background: #ffe4e9;
            color: #ff6b9d;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .screen {
                padding: 20px;
            }

            .welcome h1 {
                font-size: 2em;
            }

            .round-title {
                font-size: 1.5em;
            }

            .options-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 15px;
            }

            .option-card {
                padding: 20px 10px;
            }

            .option-icon {
                font-size: 2.5em;
            }

            .color-option {
                height: 120px;
            }

            .result-image {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Loading Screen -->
        <div class="screen active" id="loading">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">ƒêang t·∫£i d·ªØ li·ªáu... üíñ</div>
            </div>
        </div>

        <!-- Welcome Screen -->
        <div class="screen" id="welcome">
            <div class="welcome">
                <h1>‚ú® Kh√°m Ph√° B·∫£n Th√¢n üíñ</h1>
                <p>H√£y c√πng kh√°m ph√° con ng∆∞·ªùi th·∫≠t c·ªßa b·∫°n qua 3 c√¢u h·ªèi th√∫ v·ªã! üå∏<br>
                Ch·ªçn nh·ªØng g√¨ b·∫°n y√™u th√≠ch nh·∫•t v√† nh·∫≠n ngay l·ªùi ch√∫c ƒë·∫∑c bi·ªát d√†nh ri√™ng cho b·∫°n. üéÄ</p>
                <button class="btn" onclick="startGame()">B·∫Øt ƒê·∫ßu Ngay</button>
            </div>
        </div>

        <!-- Round 1: Colors -->
        <div class="screen" id="round1">
            <div class="progress-bar">
                <div class="progress-dot active"></div>
                <div class="progress-dot"></div>
                <div class="progress-dot"></div>
            </div>
            <div class="round-header">
                <div class="round-number">V√íNG 1/3</div>
                <h2 class="round-title">M√†u S·∫Øc Y√™u Th√≠ch</h2>
                <p class="round-subtitle">Ch·ªçn m√†u s·∫Øc ph·∫£n √°nh c√° t√≠nh c·ªßa b·∫°n üíï</p>
            </div>
            <div class="options-grid" id="colorOptions"></div>
            <div class="navigation">
                <button class="btn btn-secondary" onclick="goBack('welcome')">Quay L·∫°i</button>
                <button class="btn btn-primary" onclick="nextRound(1)" disabled id="btn1">Ti·∫øp Theo</button>
            </div>
        </div>

        <!-- Round 2: Food -->
        <div class="screen" id="round2">
            <div class="progress-bar">
                <div class="progress-dot active"></div>
                <div class="progress-dot active"></div>
                <div class="progress-dot"></div>
            </div>
            <div class="round-header">
                <div class="round-number">V√íNG 2/3</div>
                <h2 class="round-title">M√≥n ƒÇn Y√™u Th√≠ch</h2>
                <p class="round-subtitle">Ch·ªçn m√≥n ƒÉn l√†m b·∫°n h·∫°nh ph√∫c nh·∫•t üç∞</p>
            </div>
            <div class="options-grid" id="foodOptions"></div>
            <div class="navigation">
                <button class="btn btn-secondary" onclick="goBack('round1')">Quay L·∫°i</button>
                <button class="btn btn-primary" onclick="nextRound(2)" disabled id="btn2">Ti·∫øp Theo</button>
            </div>
        </div>

        <!-- Round 3: Flowers -->
        <div class="screen" id="round3">
            <div class="progress-bar">
                <div class="progress-dot active"></div>
                <div class="progress-dot active"></div>
                <div class="progress-dot active"></div>
            </div>
            <div class="round-header">
                <div class="round-number">V√íNG 3/3</div>
                <h2 class="round-title">Lo√†i Hoa Y√™u Th√≠ch</h2>
                <p class="round-subtitle">Ch·ªçn lo√†i hoa ƒë·∫πp nh·∫•t trong m·∫Øt b·∫°n üå∫</p>
            </div>
            <div class="options-grid" id="flowerOptions"></div>
            <div class="navigation">
                <button class="btn btn-secondary" onclick="goBack('round2')">Quay L·∫°i</button>
                <button class="btn btn-primary" onclick="showResult()" disabled id="btn3">Xem K·∫øt Qu·∫£</button>
            </div>
        </div>

        <!-- Result Screen -->
        <div class="screen" id="result">
            <div class="result">
                <div class="result-image" id="resultImage">
                    <div class="result-image-placeholder">üéâ</div>
                </div>
                <h2 class="result-message" id="resultMessage"></h2>
                <div class="result-combo" id="resultCombo"></div>
                <p class="result-description" id="resultDescription"></p>
                <button class="btn" onclick="resetGame()">Ch∆°i L·∫°i</button>
            </div>
        </div>
    </div>

    <script>
        // ===== C·∫§U H√åNH - THAY ƒê·ªîI URL CSV V√Ä FOLDER ·∫¢NH ·ªû ƒê√ÇY =====
        const CSV_URL = 'data.csv'; // Thay b·∫±ng URL CSV tr√™n GitHub: 'https://raw.githubusercontent.com/username/repo/main/data.csv'
        
        // ===== D·ªÆ LI·ªÜU C·ªê ƒê·ªäNH =====
        const colors = [
            { id: 0, name: 'ƒê·ªè', color: '#e74c3c', emoji: '‚ù§Ô∏è' },
            { id: 1, name: 'Cam', color: '#e67e22', emoji: 'üß°' },
            { id: 2, name: 'V√†ng', color: '#f1c40f', emoji: 'üíõ' },
            { id: 3, name: 'Xanh L√°', color: '#2ecc71', emoji: 'üíö' },
            { id: 4, name: 'Xanh D∆∞∆°ng', color: '#3498db', emoji: 'üíô' },
            { id: 5, name: 'T√≠m', color: '#9b59b6', emoji: 'üíú' },
            { id: 6, name: 'H·ªìng', color: '#ff69b4', emoji: 'ü©∑' }
        ];

        const foods = [
            { id: 0, name: 'Ph·ªü', emoji: 'üçú' },
            { id: 1, name: 'Pizza', emoji: 'üçï' },
            { id: 2, name: 'Sushi', emoji: 'üç£' },
            { id: 3, name: 'B√°nh M√¨', emoji: 'ü•ñ' },
            { id: 4, name: 'Burger', emoji: 'üçî' },
            { id: 5, name: 'M√¨ √ù', emoji: 'üçù' },
            { id: 6, name: 'G√† R√°n', emoji: 'üçó' },
            { id: 7, name: 'Taco', emoji: 'üåÆ' },
            { id: 8, name: 'C∆°m', emoji: 'üçö' },
            { id: 9, name: 'Salad', emoji: 'ü•ó' }
        ];

        const flowers = [
            { id: 0, name: 'H·ªìng', emoji: 'üåπ' },
            { id: 1, name: 'Tulip', emoji: 'üå∑' },
            { id: 2, name: 'H∆∞·ªõng D∆∞∆°ng', emoji: 'üåª' },
            { id: 3, name: 'Mai', emoji: 'üåº' },
            { id: 4, name: 'Sen', emoji: 'ü™∑' },
            { id: 5, name: 'Lan', emoji: 'üå∏' },
            { id: 6, name: 'Anh ƒê√†o', emoji: 'üå∫' },
            { id: 7, name: 'C√∫c', emoji: 'üíê' },
            { id: 8, name: 'O·∫£i H∆∞∆°ng', emoji: 'ü™ª' },
            { id: 9, name: 'Lily', emoji: 'üèµÔ∏è' }
        ];

        // ===== BI·∫æN TO√ÄN C·ª§C =====
        let selections = {
            color: null,
            food: null,
            flower: null
        };

        let dataLoaded = false;
        let messagesData = {}; // L∆∞u tr·ªØ d·ªØ li·ªáu t·ª´ CSV

        // ===== H√ÄM ƒê·ªåC CSV =====
        async function loadCSVData() {
            try {
                const response = await fetch(CSV_URL);
                if (!response.ok) {
                    throw new Error('Kh√¥ng th·ªÉ t·∫£i file CSV');
                }
                
                const csvText = await response.text();
                parseCSV(csvText);
                
                dataLoaded = true;
                console.log('‚úÖ ƒê√£ t·∫£i th√†nh c√¥ng', Object.keys(messagesData).length, 't·ªï h·ª£p');
                
                // Chuy·ªÉn t·ª´ loading sang welcome
                showScreen('welcome');
            } catch (error) {
                console.error('‚ùå L·ªói khi t·∫£i CSV:', error);
                
                // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
                document.getElementById('loading').innerHTML = `
                    <div class="loading">
                        <div style="font-size: 3em; margin-bottom: 20px;">‚ö†Ô∏è</div>
                        <div class="loading-text">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu</div>
                        <div class="error-message">
                            Vui l√≤ng ki·ªÉm tra:<br>
                            1. File CSV c√≥ t·ªìn t·∫°i t·∫°i: <strong>${CSV_URL}</strong><br>
                            2. ƒê∆∞·ªùng d·∫´n ƒë√∫ng ƒë·ªãnh d·∫°ng<br>
                            3. K·∫øt n·ªëi internet ·ªïn ƒë·ªãnh
                        </div>
                        <button class="btn" onclick="location.reload()" style="margin-top: 20px;">Th·ª≠ L·∫°i</button>
                    </div>
                `;
            }
        }

        // ===== H√ÄM PARSE CSV =====
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            // T√¨m v·ªã tr√≠ c√°c c·ªôt
            const idIndex = headers.indexOf('id');
            const loiChucIndex = headers.indexOf('loi_chuc');
            const anhIndex = headers.indexOf('anh_url');
            
            if (idIndex === -1 || loiChucIndex === -1 || anhIndex === -1) {
                throw new Error('CSV thi·∫øu c·ªôt b·∫Øt bu·ªôc: id, loi_chuc, anh_url');
            }
            
            // Parse t·ª´ng d√≤ng
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // Parse d√≤ng CSV (x·ª≠ l√Ω tr∆∞·ªùng h·ª£p c√≥ d·∫•u ph·∫©y trong quotes)
                const values = parseCSVLine(line);
                
                const id = values[idIndex]?.trim();
                const loiChuc = values[loiChucIndex]?.trim().replace(/^"|"$/g, ''); // B·ªè quotes
                const anhUrl = values[anhIndex]?.trim();
                
                if (id && loiChuc && anhUrl) {
                    messagesData[id] = {
                        message: loiChuc,
                        imageUrl: anhUrl
                    };
                }
            }
        }

        // ===== H√ÄM PARSE CSV LINE (X·ª¨ L√ù QUOTES) =====
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            
            return result;
        }

        // ===== KH·ªûI T·∫†O GAME =====
        function initializeRounds() {
            // Render colors
            const colorContainer = document.getElementById('colorOptions');
            colors.forEach(color => {
                const div = document.createElement('div');
                div.className = 'color-option';
                div.style.background = `linear-gradient(135deg, ${color.color}, ${adjustColor(color.color, -30)})`;
                div.innerHTML = `<div class="color-name">${color.emoji} ${color.name}</div>`;
                div.onclick = () => selectOption('color', color.id, div);
                colorContainer.appendChild(div);
            });

            // Render foods
            const foodContainer = document.getElementById('foodOptions');
            foods.forEach(food => {
                const div = document.createElement('div');
                div.className = 'option-card';
                div.innerHTML = `
                    <div class="option-icon">${food.emoji}</div>
                    <div class="option-name">${food.name}</div>
                `;
                div.onclick = () => selectOption('food', food.id, div);
                foodContainer.appendChild(div);
            });

            // Render flowers
            const flowerContainer = document.getElementById('flowerOptions');
            flowers.forEach(flower => {
                const div = document.createElement('div');
                div.className = 'option-card';
                div.innerHTML = `
                    <div class="option-icon">${flower.emoji}</div>
                    <div class="option-name">${flower.name}</div>
                `;
                div.onclick = () => selectOption('flower', flower.id, div);
                flowerContainer.appendChild(div);
            });
        }

        function adjustColor(color, percent) {
            const num = parseInt(color.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255))
                .toString(16).slice(1);
        }

        function selectOption(type, id, element) {
            const container = element.parentElement;
            container.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selections[type] = id;
            
            const btnId = type === 'color' ? 'btn1' : type === 'food' ? 'btn2' : 'btn3';
            document.getElementById(btnId).disabled = false;
        }

        function startGame() {
            showScreen('round1');
        }

        function nextRound(round) {
            if (round === 1) {
                showScreen('round2');
            } else if (round === 2) {
                showScreen('round3');
            }
        }

        function goBack(screen) {
            showScreen(screen);
        }

        function showResult() {
            const key = `${selections.color}-${selections.food}-${selections.flower}`;
            const result = messagesData[key];

            if (!result) {
                console.error('‚ùå Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu cho combo:', key);
                alert('L·ªói: Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu cho t·ªï h·ª£p n√†y!');
                return;
            }

            // Hi·ªÉn th·ªã ·∫£nh
            const resultImageContainer = document.getElementById('resultImage');
            resultImageContainer.innerHTML = `<img src="${result.imageUrl}" alt="K·∫øt qu·∫£" onerror="this.parentElement.innerHTML='<div class=\'result-image-placeholder\'>üéâ</div>'">`;

            // Hi·ªÉn th·ªã l·ªùi ch√∫c
            document.getElementById('resultMessage').textContent = 'üéâ D√†nh Cho B·∫°n üéâ';
            document.getElementById('resultDescription').textContent = result.message;

            // Hi·ªÉn th·ªã combo ƒë√£ ch·ªçn
            const comboContainer = document.getElementById('resultCombo');
            comboContainer.innerHTML = `
                <div class="combo-item">${colors[selections.color].emoji} ${colors[selections.color].name}</div>
                <div class="combo-item">${foods[selections.food].emoji} ${foods[selections.food].name}</div>
                <div class="combo-item">${flowers[selections.flower].emoji} ${flowers[selections.flower].name}</div>
            `;

            showScreen('result');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function resetGame() {
            selections = { color: null, food: null, flower: null };
            document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.btn-primary').forEach(btn => btn.disabled = true);
            showScreen('welcome');
        }

        // ===== KH·ªûI ƒê·ªòNG =====
        // Initialize game UI
        initializeRounds();

        // Load CSV data
        loadCSVData();
    </script>
</body>
</html>