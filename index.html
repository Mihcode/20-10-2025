<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mừng ngày Phụ nữ Việt Nam 20/10</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🌹</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #ffdde1 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(255, 105, 180, 0.3);
            max-width: 800px;
            width: 100%;
            overflow: hidden;
            position: relative;
            border: 3px solid rgba(255, 182, 193, 0.3);
        }

        .container::after {
            content: 'Created by Mai Hoàng Minh'; 
            position: absolute;
            bottom: 15px; 
            right: 20px;  
            font-size: 12px;
            color: #cccccc; 
            font-style: italic;
            pointer-events: none;
        }
        .screen {
            display: none;
            padding: 40px;
            min-height: 500px;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading Screen */
        .loading {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 107, 157, 0.2);
            border-top-color: #ff6b9d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2em;
            color: #ff6b9d;
            font-weight: 600;
        }

        /* Welcome Screen */
        .welcome {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .welcome h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #ff6b9d, #ff8fab, #ffc3d9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .welcome p {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .btn {
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.6);
        }

        /* Main Screens */
        .round-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .round-number {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
        }

        .round-title {
            font-size: 2em;
            color: #ff6b9d;
            margin-bottom: 10px;
        }

        .round-subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .option-card {
            background: linear-gradient(135deg, #fff5f7 0%, #ffe4e9 100%);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .option-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
        }

        .option-card.selected {
            border-color: #ff6b9d;
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            color: white;
        }

        .option-card.selected::before {
            opacity: 1;
        }

        .option-icon {
            font-size: 3.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            filter: drop-shadow(2px 2px 4px rgba(255, 107, 157, 0.2));
        }

        .option-name {
            font-size: 1.1em;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ffd4e5;
            transition: all 0.3s;
        }

        .progress-dot.active {
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            width: 30px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(255, 107, 157, 0.4);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
            flex: 1;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            flex: 1;
        }

        /* Result Screen */
        .result {
            text-align: center;
        }

        .result-image {
            width: 100%;
            max-width: 500px;
            height: 350px;
            background: linear-gradient(135deg, #fff5f7, #ffe4e9);
            border-radius: 20px;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.2);
            border: 3px solid rgba(255, 182, 193, 0.3);
        }

        .result-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .result-image-placeholder {
            font-size: 6em;
        }

        .result-message {
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .result-description {
            color: #666;
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .result-combo {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .combo-item {
            background: linear-gradient(135deg, #fff5f7, #ffe4e9);
            padding: 15px 25px;
            border-radius: 15px;
            font-weight: 600;
            color: #ff6b9d;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.2);
        }

        .error-message {
            background: #ffe4e9;
            color: #ff6b9d;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .screen {
                padding: 20px;
            }

            .welcome h1 {
                font-size: 2em;
            }

            .round-title {
                font-size: 1.5em;
            }

            .options-grid {
                grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
                gap: 15px;
            }

            .option-card {
                padding: 20px 10px;
            }

            .option-icon {
                font-size: 2.5em;
            }

            .result-image {
                height: 250px;
            }

            .result-description {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Loading Screen -->
        <div class="screen active" id="loading">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">Đang tải dữ liệu... 💖</div>
            </div>
        </div>

        <!-- Welcome Screen -->
        <div class="screen" id="welcome">
            <div class="welcome">
                <h1>🌹 Chúc Mừng Ngày Phụ Nữ Việt Nam 20/10 🌹</h1>
                <p>Nhân dịp ngày Phụ nữ Việt Nam 20/10, hãy chọn loài hoa và món ăn yêu thích của bạn 🌸<br>
                Để nhận ngay lời chúc đặc biệt được gửi gắm đến bạn! 💝</p>
                <button class="btn" onclick="startGame()">Bắt Đầu Ngay</button>
            </div>
        </div>

        <!-- Flowers -->
        <div class="screen" id="round1">
            <div class="progress-bar">
                <div class="progress-dot active"></div>
                <div class="progress-dot"></div>
            </div>
            <div class="round-header">
                <div class="round-number">1/2</div>
                <h2 class="round-title">Loài Hoa Yêu Thích</h2>
                <p class="round-subtitle">Chọn loài hoa đẹp nhất trong mắt bạn 🌺</p>
            </div>
            <div class="options-grid" id="flowerOptions"></div>
            <div class="navigation">
                <button class="btn btn-secondary" onclick="goBack('welcome')">Quay Lại</button>
                <button class="btn btn-primary" onclick="nextRound()" disabled id="btn1">Tiếp Theo</button>
            </div>
        </div>

        <!-- Food -->
        <div class="screen" id="round2">
            <div class="progress-bar">
                <div class="progress-dot active"></div>
                <div class="progress-dot active"></div>
            </div>
            <div class="round-header">
                <div class="round-number">2/2</div>
                <h2 class="round-title">Món Ăn Yêu Thích</h2>
                <p class="round-subtitle">Chọn món ăn làm bạn hạnh phúc nhất 🍰</p>
            </div>
            <div class="options-grid" id="foodOptions"></div>
            <div class="navigation">
                <button class="btn btn-secondary" onclick="goBack('round1')">Quay Lại</button>
                <button class="btn btn-primary" onclick="showResult()" disabled id="btn2">Xem Kết Quả</button>
            </div>
        </div>

        <!-- Result Screen -->
        <div class="screen" id="result">
            <div class="result">
                <div class="result-image" id="resultImage">
                    <div class="result-image-placeholder">🎉</div>
                </div>
                <h2 class="result-message" id="resultMessage"></h2>
                <div class="result-combo" id="resultCombo"></div>
                <p class="result-description" id="resultDescription"></p>
            </div>
        </div>
    </div>

    <script>
        const CSV_URL = 'data.csv'; 
        
        const flowers = [
            { id: 0, name: 'Hoa Hồng', emoji: '🌹' },
            { id: 1, name: 'Hoa Cúc', emoji: '🌼' },
            { id: 2, name: 'Hướng Dương', emoji: '🌻' },
            { id: 3, name: 'Hoa Ly', emoji: '🌷' },
            { id: 4, name: 'Hoa Sen', emoji: '🪷' }
        ];

        const foods = [
            { id: 0, name: 'Trà Sữa', emoji: '🧋' },
            { id: 1, name: 'Bánh Ngọt', emoji: '🍰' },
            { id: 2, name: 'Sushi', emoji: '🍣' },
            { id: 3, name: 'Salad', emoji: '🥗' },
            { id: 4, name: 'Mì Ý', emoji: '🍝' },
            { id: 5, name: 'Chocolate', emoji: '🍫' },
            { id: 6, name: 'Kem', emoji: '🍦' },
            { id: 7, name: 'Pizza', emoji: '🍕' },
            { id: 8, name: 'Matcha', emoji: '🍵' },
            { id: 9, name: 'Macarons', emoji: '🧁' }
        ];

        let selections = {
            flower: null,
            food: null
        };

        let dataLoaded = false;
        let messagesData = {}; 

        async function loadCSVData() {
            try {
                const response = await fetch(CSV_URL);
                if (!response.ok) {
                    throw new Error('Không thể tải file CSV');
                }
                
                const csvText = await response.text();
                parseCSV(csvText);
                
                dataLoaded = true;
                console.log('✅ Đã tải thành công', Object.keys(messagesData).length, 'tổ hợp');
                
                showScreen('welcome');
            } catch (error) {
                console.error('❌ Lỗi rồi:', error);
                
                document.getElementById('loading').innerHTML = `
                    <div class="loading">
                        <div style="font-size: 3em; margin-bottom: 20px;">⚠️</div>
                        <div class="loading-text">Không thể tải dữ liệu</div>
                        <div class="error-message">
                            Vui lòng kiểm tra:<br>
                            1. File CSV có tồn tại tại: <strong>${CSV_URL}</strong><br>
                            2. Đường dẫn đúng định dạng<br>
                            3. Kết nối internet ổn định
                        </div>
                        <button class="btn" onclick="location.reload()" style="margin-top: 20px;">Thử Lại</button>
                    </div>
                `;
            }
        }

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const delimiter = lines[0].includes(';') ? ';' : ',';
            const headers = lines[0].split(delimiter).map(h => h.trim());
            
            const idIndex = headers.indexOf('id');
            const loiChucIndex = headers.indexOf('loi_chuc');
            const anhIndex = headers.indexOf('anh_url');
            
            if (idIndex === -1 || loiChucIndex === -1 || anhIndex === -1) {
                throw new Error('Có lỗi rồi');
            }
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const values = parseCSVLine(line, delimiter);
                
                const id = values[idIndex]?.trim();
                const loiChuc = values[loiChucIndex]?.trim();
                const anhUrl = values[anhIndex]?.trim();
                
                if (id && loiChuc && anhUrl) {
                    messagesData[id] = {
                        message: loiChuc,
                        imageUrl: anhUrl
                    };
                }
            }
        }

        function parseCSVLine(line, delimiter) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === delimiter && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            
            return result;
        }

        function initializeRounds() {
            const flowerContainer = document.getElementById('flowerOptions');
            flowers.forEach(flower => {
                const div = document.createElement('div');
                div.className = 'option-card';
                div.innerHTML = `
                    <div class="option-icon">${flower.emoji}</div>
                    <div class="option-name">${flower.name}</div>
                `;
                div.onclick = () => selectOption('flower', flower.id, div);
                flowerContainer.appendChild(div);
            });

            const foodContainer = document.getElementById('foodOptions');
            foods.forEach(food => {
                const div = document.createElement('div');
                div.className = 'option-card';
                div.innerHTML = `
                    <div class="option-icon">${food.emoji}</div>
                    <div class="option-name">${food.name}</div>
                `;
                div.onclick = () => selectOption('food', food.id, div);
                foodContainer.appendChild(div);
            });
        }

        function selectOption(type, id, element) {
            const container = element.parentElement;
            container.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selections[type] = id;
            
            const btnId = type === 'flower' ? 'btn1' : 'btn2';
            document.getElementById(btnId).disabled = false;
        }

        function startGame() {
            showScreen('round1');
        }

        function nextRound() {
            showScreen('round2');
        }

        function goBack(screen) {
            showScreen(screen);
        }

        function showResult() {
            const key = `${selections.flower}-${selections.food}`;
            const result = messagesData[key];

            if (!result) {
                console.error('Không thể đọc được bạn', key);
                alert('Không tìm thấy dữ liệu cho tổ hợp này!\nCombo: ' + key);
                return;
            }

            const resultImageContainer = document.getElementById('resultImage');
            resultImageContainer.innerHTML = `<img src="${result.imageUrl}" alt="Kết quả" onerror="this.parentElement.innerHTML='<div class=\\'result-image-placeholder\\'>🎉</div>'">`;

            document.getElementById('resultMessage').textContent = '💖 Người thực sự muốn gửi lời chúc đến bạn 💖';
            document.getElementById('resultDescription').textContent = result.message;

            const comboContainer = document.getElementById('resultCombo');
            comboContainer.innerHTML = `
                <div class="combo-item">${flowers[selections.flower].emoji} ${flowers[selections.flower].name}</div>
                <div class="combo-item">${foods[selections.food].emoji} ${foods[selections.food].name}</div>
            `;

            showScreen('result');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        initializeRounds();
        loadCSVData();
    </script>
</body>
</html>

